<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Manager</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/decap-cms@2.15.1/dist/decap-cms.js"></script>
  <style>
    #status{font-family:system-ui,Segoe UI,Roboto,Arial;margin:16px;padding:12px;border-left:4px solid #f4b400;background:#fff}
  </style>
</head>
<body>
  <div id="status">Booting…</div>
  <script>
    function setStatus(m){ const n=document.getElementById('status'); if(n) n.innerHTML=m; }
    if (window.netlifyIdentity){
      netlifyIdentity.on('init', u => { if(!u) netlifyIdentity.open('login'); });
      netlifyIdentity.on('login', () => location.reload());
      netlifyIdentity.on('logout', () => location.reload());
    }
    (function wait(i=1){
      if (window.CMS && typeof CMS.init==='function'){
        setStatus('CMS loaded. Fetching /admin/config.yml …');
        try{ CMS.registerEventListener({name:'error',handler:({error})=>setStatus('CMS error: '+(error?.message||String(error))) }); }catch(e){}
        return;
      }
      if (i>40) return setStatus('CMS failed to load (CDN blocked?). Try another browser/network.');
      setTimeout(()=>wait(i+1),150);
    })();
  </script>
</body>
</html>
